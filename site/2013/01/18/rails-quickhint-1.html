<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>


	<title>Seichy's Missing Bit  | Rails Quickhint #1: Creating a model while skipping validations </title>
	
	<link rel="stylesheet" href="/css/screen.css">
	<link rel="alternate" type="application/rss+xml" title="RSS Feed for martianwabbit.com" href="http://feeds.feedburner.com/SeichysMissingBit" />

	<script src="/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<div class="container center">
	<header id="top">
		<h1>
			<a href="/">Seichy's Missing Bit</a>
		</h1>
	</header>

	<div class="content">
	<article class="post">
		<header>
			<h1>
				<a href="">Rails Quickhint #1: Creating a model while skipping validations</a>
			</h1>
			<time>January 18, 2013</time>
		</header>
		<p>
	This certainly needs some background. I've been working on a random rails project for the better part of the last couple of months. 
	This project uses devise to manage logins and user registration. Recently registrations started failing in the site which, didn't 
	make sense since they had been working fine for a while. So I started digging into it.
</p>

<p>
	According to rails the user url didn't exist so it couldn't redirect back to the homepage after a successful registration. 
	After much digging around the stack trace I finally figured it out. Turns out that when a devise user is create a user profile is created along with it(this is specific to my application). But, that's normal, what started causing problems was that the profile had a validation for a unique username, which blank, wasn't (since the username is only supposed to be set after registration).
</p>

<p>
	So, what's the solution? Easy, all I had to make sure of was that when I created the user profile I disabled validations for the user profile model. Here's how I did it:
</p>

<p>user.rb</p>
<pre>
<code data-language="ruby">
class User < ActiveRecord::Base
  after_create :create_profile
  has_one :user_profile, :dependent => :destroy
  
  def create_profile
    self.build_user_profile
    self.user_profile.save(:validate => false)
  end
end
</code>
</pre>

<p>user_profile.rb</p>
<pre>
<code data-language="ruby">
class UserProfile < ActiveRecord::Base
  belongs_to :user
 
  attr_accessible :username
  validates_uniqueness_of :username
end
</code>
</pre>

<p>This bug took around 2 hours to fix, I guess not all errors in rails are as descriptive and easy to follow as they should. But at the end of it all, it's my fault for not paying attention.</p>
	</article>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'martianwabbitblog'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	<footer>
		David Sergio DÃ­az &copy; All Rights Reserved.
		<br>
		Happily hosted on <a href="http://www.webfaction.com?affiliate=seich">WebFaction</a>
	</footer>
</div>

	<script src="/js/zepto.js"></script>
	<script src="/js/main.js"></script>
	<script>
        var _gaq=[['_setAccount','UA-2565966-9'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
</body>
</html>